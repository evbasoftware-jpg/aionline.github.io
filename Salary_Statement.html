<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Salary Statement</title>

<!-- ‚úÖ SheetJS -->
<script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f9;
    padding:20px;
}
h2{color:#333}

#search_section{
    display:none;
    margin-top:20px;
    padding:20px;
    background:white;
    border-radius:20px;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
    width:360px;
}

input[type=text]{
    width:100%;
    padding:10px;
    border-radius:20px;
    border:1px solid #ccc;
}

button{
    padding:8px 15px;
    margin-top:8px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
}

#printBtn{background:#ffe066}
#search_btn{background:#a5d8ff}
#prev_btn{background:#c3fae8}
#next_btn{background:#f3d9fa}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
    background:white;
}
th,td{
    border:1px solid #ccc;
    padding:6px;
    text-align:center;
}
th{
    background:#1971c2;
    color:white;
}

.summary{
    background:#fff3bf;
    font-weight:bold;
}
</style>
</head>

<body>

<h2>Upload Excel File</h2>
<input type="file" id="excel_file" accept=".xlsx,.xls">

<!-- üîç SEARCH SECTION -->
<div id="search_section">
    <label><b>Search Employee</b></label>
    <input type="text" id="searchBox" list="name_list" placeholder="Enter Name">
    <datalist id="name_list"></datalist>

    <div style="text-align:center">
        <button id="search_btn">Search</button><br>
        <button id="prev_btn">‚Üê Previous</button>
        <button id="next_btn">Next ‚Üí</button><br>
        <button id="printBtn" onclick="window.print()">Print / PDF</button>
    </div>
</div>

<div id="table_container"></div>

<script>
/* ================= SAFETY ================= */
document.getElementById("search_section").style.display = "none";

/* ================= GLOBAL ================= */
let allRows = [];
let nameSet = [];

/* ================= FILE UPLOAD ================= */
document.getElementById("excel_file").addEventListener("change", function(e){

    // üî• ALWAYS SHOW SEARCH SECTION
    document.getElementById("search_section").style.display = "block";
    document.getElementById("table_container").innerHTML =
        "<b style='color:blue'>Reading Excel file...</b>";

    try{
        const file = e.target.files[0];
        if(!file) return;

        const reader = new FileReader();

        reader.onload = function(ev){
            try{
                const data = new Uint8Array(ev.target.result);
                const wb = XLSX.read(data, {type:"array"});

                allRows = [];
                nameSet = [];

                wb.SheetNames.forEach(s=>{
                    const ws = wb.Sheets[s];
                    const rows = XLSX.utils.sheet_to_json(ws,{header:1,defval:""});

                    rows.forEach(r=>{
                        if(r.join("").trim().length>3){
                            allRows.push(r);
                            if(r[2]) nameSet.push(String(r[2]).trim());
                        }
                    });
                });

                // populate datalist
                const dl = document.getElementById("name_list");
                dl.innerHTML="";
                [...new Set(nameSet)].forEach(n=>{
                    const o=document.createElement("option");
                    o.value=n;
                    dl.appendChild(o);
                });

                document.getElementById("table_container").innerHTML =
                    "<b style='color:green'>‚úî Excel loaded successfully</b>";

            }catch(err){
                alert("Excel parse error: "+err.message);
            }
        };

        reader.readAsArrayBuffer(file);

    }catch(e){
        alert("File error: "+e.message);
    }
});

/* ================= SEARCH ================= */
document.getElementById("search_btn").onclick = function(){
    const key = document.getElementById("searchBox").value.trim().toUpperCase();
    if(!key){ alert("Enter name"); return; }

    let html = `<table>
    <tr><th>DATA</th></tr>`;

    let found=false;

    allRows.forEach(r=>{
        if(String(r.join(" ")).toUpperCase().includes(key)){
            found=true;
            html+=`<tr><td>${r.join(" | ")}</td></tr>`;
        }
    });

    html+=`</table>`;

    document.getElementById("table_container").innerHTML =
        found ? html : "<b style='color:red'>No record found</b>";
};

/* ================= NAVIGATION ================= */
function nav(dir){
    const box=document.getElementById("searchBox");
    const arr=[...document.getElementById("name_list").options].map(o=>o.value);
    let i=arr.indexOf(box.value);
    if(dir==="next") i=(i+1)%arr.length;
    else i=(i-1+arr.length)%arr.length;
    box.value=arr[i];
    document.getElementById("search_btn").click();
}

document.getElementById("prev_btn").onclick=()=>nav("prev");
document.getElementById("next_btn").onclick=()=>nav("next");
</script>

</body>
</html>
